import math

class Solution:
    def minSquares(self, n: int) -> int:
        # helper: is x a perfect square?
        is_square = lambda x: int(x**0.5)**2 == x

        # 1) perfect square?
        if is_square(n): return 1

        # 2) remove factors of 4
        while n % 4 == 0: n //= 4

        # 3) if n % 8 == 7 then by Legendre's theorem answer is 4
        if n % 8 == 7: return 4

        # 4) check if sum of two squares -> answer 2
        return 2 if any(is_square(n - a*a) for a in range(1, math.isqrt(n)+1)) else 3
